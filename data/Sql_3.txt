select distinct d.internal_ind, d.domain_name, d.company_name, 
p.user_name from dna_domain d, principal p, user_principal up,
principal_role_xref prx, role_permission_xref rpx where 
d.domain_security_status_code = 'Active' and d.internal_ind = 'N'
or d.domain_id = p.domain_id and p.principal_status_code = 'Active'
and not exists (select p3.principal_id from principal p3, principal_role_xref prx3,
role_permission_xref rpx3 where p.principal_id = p3.principal_id
and p3.principal_id = prx3.principal_id and prx3.role_id = rpx3.role_id
and rpx3.resource_name in ('TCAM Access', 'TCAM Desktop','TCAM Notifications ByContact',
'L3AGENT Credit Applications', 'L3AGENT LOA Forms', 'L3AGENT OnNet Buildings',
'L3AGENT Service Agreements')) order by 1, 2, 4, 5

