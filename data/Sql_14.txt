SELect COUNT(DISTINCT T4.VW_CUST_ACCT_KEY) FROM ( (SELECT DISTINCT CUST_ACCT_SUBSCR_FACT.VW_CUST_ACCT_KEY
FROM DDWP_V.CUST_ACCT_SUBSCR_FACT CUST_ACCT_SUBSCR_FACT, DDWP_V.SVC_OFR_DIM SVC_OFR_DIM, DDWP_V.SUBSCR_TRANSN_DIM
SUBSCR_TRANSN_DIM, DDWP_V.CUST_ACCT_TYPE_DIM T4, DDWP_V.ACRDDM_STAT_AGD2 T5 WHERE SVC_OFR_DIM.SVC_PREFIX_CODE = 'R'
AND SVC_OFR_DIM.SVC_CODE = 101995 AND SVC_OFR_DIM.SVC_OFR_CODE IN (100, 101, 102) AND CUST_ACCT_SUBSCR_FACT.BGN_MONTHDAY_KEY <=
'2013-12-29' AND CUST_ACCT_SUBSCR_FACT.END_MONTHDAY_KEY > '2013-12-29' AND SUBSCR_TRANSN_DIM.SUBSCR_NEW_STAT_CODE = 'ACTV'
AND T5.ACRD_STAT_KEY = CUST_ACCT_SUBSCR_FACT.ACRD_STAT_KEY AND T5.ACRD_TYPE_CODE = 'P' AND CUST_ACCT_SUBSCR_FACT.SVC_OFR_KEY =
SVC_OFR_DIM.SVC_OFR_KEY AND SUBSCR_TRANSN_DIM.SUBSCR_TRANSN_KEY = CUST_ACCT_SUBSCR_FACT.SUBSCR_TRANSN_KEY AND
T4.CUST_ACCT_TYPE_KEY = CUST_ACCT_SUBSCR_FACT.REC_CUST_ACCT_TYPE_KEY AND T4.CUST_ACCT_MKT_DESC = 'RESIDENTIAL') T1
JOIN (SELECT DISTINCT CUST_ACCT_SUBSCR_FACT.VW_CUST_ACCT_KEY , SVC_OFR_DIM.SVC_PREFIX_CODE C1 , SVC_OFR_DIM.SVC_CODE C2 ,
SVC_OFR_DIM.SVC_OFR_CODE C3 , CUST_ACCT_SUBSCR_FACT.BGN_MONTHDAY_KEY C4 , CUST_ACCT_SUBSCR_FACT.END_MONTHDAY_KEY C5 ,
SUBSCR_TRANSN_DIM.SUBSCR_NEW_STAT_CODE C6 FROM DDWP_V.CUST_ACCT_SUBSCR_FACT CUST_ACCT_SUBSCR_FACT, DDWP_V.SVC_OFR_DIM
SVC_OFR_DIM, DDWP_V.SUBSCR_TRANSN_DIM SUBSCR_TRANSN_DIM, DDWP_V.CUST_ACCT_TYPE_DIM T4, DDWP_V.ACRDDM_STAT_AGD2 T5 ,
DDWP_V.CUST_ACCT_STAT_DIM casd WHERE SVC_OFR_DIM.SVC_PREFIX_CODE = 'R' AND (SVC_OFR_DIM.SVC_CODE = 102768 AND
SVC_OFR_DIM.SVC_OFR_CODE IN (700, 701, 702, 703, 704, 705, 11, 16)) AND CUST_ACCT_SUBSCR_FACT.BGN_MONTHDAY_KEY <=
'2014-05-28' AND CUST_ACCT_SUBSCR_FACT.END_MONTHDAY_KEY > '2014-05-22' AND SUBSCR_TRANSN_DIM.SUBSCR_NEW_STAT_CODE =
'ACTV' AND T4.CUST_ACCT_MKT_DESC = 'RESIDENTIAL' AND T5.ACRD_STAT_KEY = CUST_ACCT_SUBSCR_FACT.ACRD_STAT_KEY AND T5.ACRD_TYPE_CODE
= 'P' AND CUST_ACCT_SUBSCR_FACT.SVC_OFR_KEY = SVC_OFR_DIM.SVC_OFR_KEY AND SUBSCR_TRANSN_DIM.SUBSCR_TRANSN_KEY =
CUST_ACCT_SUBSCR_FACT.SUBSCR_TRANSN_KEY AND T4.CUST_ACCT_TYPE_KEY = CUST_ACCT_SUBSCR_FACT.REC_CUST_ACCT_TYPE_KEY AND
casd.CUST_ACCT_STAT_KEY = CUST_ACCT_SUBSCR_FACT.REC_CUST_ACCT_STAT_KEY AND casd.CUST_ACCT_STAT_CODE= 'ACTV' AND casd.CUTOFF_LEV_CODE
<> 2) T2 ON T1.VW_CUST_ACCT_KEY = T2.VW_CUST_ACCT_KEY) JOIN (SELECT DISTINCT CUST_ACCT_SUBSCR_FACT.VW_CUST_ACCT_KEY ,
SVC_OFR_DIM.SVC_PREFIX_CODE C1 , SVC_OFR_DIM.SVC_CODE C2 , SVC_OFR_DIM.SVC_OFR_CODE C3 , CUST_ACCT_SUBSCR_FACT.BGN_MONTHDAY_KEY
C4 , CUST_ACCT_SUBSCR_FACT.END_MONTHDAY_KEY C5 , SUBSCR_TRANSN_DIM.SUBSCR_NEW_STAT_CODE C6 FROM DDWP_V.CUST_ACCT_SUBSCR_FACT
CUST_ACCT_SUBSCR_FACT, DDWP_V.SVC_OFR_DIM SVC_OFR_DIM, DDWP_V.SUBSCR_TRANSN_DIM SUBSCR_TRANSN_DIM, DDWP_V.CUST_ACCT_TYPE_DIM
T4, DDWP_V.ACRDDM_STAT_AGD2 T5 , DDWP_V.CUST_ACCT_STAT_DIM casd WHERE SVC_OFR_DIM.SVC_PREFIX_CODE = 'R' AND
(SVC_OFR_DIM.SVC_CODE = 102768 AND SVC_OFR_DIM.SVC_OFR_CODE IN (700, 701, 702, 703, 704, 705, 11, 16)) AND
CUST_ACCT_SUBSCR_FACT.BGN_MONTHDAY_KEY = '2014-05-28' AND CUST_ACCT_SUBSCR_FACT.END_MONTHDAY_KEY > '2014-05-28' AND
SUBSCR_TRANSN_DIM.SUBSCR_NEW_STAT_CODE = 'DISC' AND T4.CUST_ACCT_MKT_DESC = 'RESIDENTIAL' AND T5.ACRD_STAT_KEY =
CUST_ACCT_SUBSCR_FACT.ACRD_STAT_KEY AND T5.ACRD_TYPE_CODE = 'P' AND CUST_ACCT_SUBSCR_FACT.SVC_OFR_KEY = SVC_OFR_DIM.SVC_OFR_KEY
AND SUBSCR_TRANSN_DIM.SUBSCR_TRANSN_KEY = CUST_ACCT_SUBSCR_FACT.SUBSCR_TRANSN_KEY AND T4.CUST_ACCT_TYPE_KEY =
CUST_ACCT_SUBSCR_FACT.REC_CUST_ACCT_TYPE_KEY AND casd.CUST_ACCT_STAT_KEY = CUST_ACCT_SUBSCR_FACT.REC_CUST_ACCT_STAT_KEY
AND casd.CUST_ACCT_STAT_CODE= 'ACTV' AND casd.CUTOFF_LEV_CODE <> 2) T3 ON T2.VW_CUST_ACCT_KEY = T3.VW_CUST_ACCT_KEY JOIN
(SELECT DISTINCT CUST_ACCT_SUBSCR_FACT.VW_CUST_ACCT_KEY , CUST_ACCT_SUBSCR_FACT.ACRD_ID , SVC_OFR_DIM.SVC_PREFIX_CODE C1 ,
SVC_OFR_DIM.SVC_CODE C2 , SVC_OFR_DIM.SVC_OFR_CODE C3 , CUST_ACCT_SUBSCR_FACT.BGN_MONTHDAY_KEY C4 ,
CUST_ACCT_SUBSCR_FACT.END_MONTHDAY_KEY C5 , SUBSCR_TRANSN_DIM.SUBSCR_NEW_STAT_CODE C6 FROM DDWP_V.CUST_ACCT_SUBSCR_FACT
CUST_ACCT_SUBSCR_FACT, DDWP_V.SVC_OFR_DIM SVC_OFR_DIM, DDWP_V.SUBSCR_TRANSN_DIM SUBSCR_TRANSN_DIM, DDWP_V.CUST_ACCT_TYPE_DIM
T4, DDWP_V.ACRDDM_STAT_AGD2 T5 , DDWP_V.CUST_ACCT_STAT_DIM casd WHERE SVC_OFR_DIM.SVC_PREFIX_CODE = 'R' AND (SVC_OFR_DIM.SVC_CODE =
102768 AND SVC_OFR_DIM.SVC_OFR_CODE IN (700, 701, 702, 703, 704, 705, 11, 16)) AND CUST_ACCT_SUBSCR_FACT.BGN_MONTHDAY_KEY =
'2014-05-28' AND CUST_ACCT_SUBSCR_FACT.END_MONTHDAY_KEY > '2014-05-28' AND SUBSCR_TRANSN_DIM.SUBSCR_NEW_STAT_CODE = 'ACTV' AND
T4.CUST_ACCT_MKT_DESC = 'RESIDENTIAL' AND T5.ACRD_STAT_KEY = CUST_ACCT_SUBSCR_FACT.ACRD_STAT_KEY AND T5.ACRD_TYPE_CODE = 'P'
AND CUST_ACCT_SUBSCR_FACT.SVC_OFR_KEY = SVC_OFR_DIM.SVC_OFR_KEY AND SUBSCR_TRANSN_DIM.SUBSCR_TRANSN_KEY =
CUST_ACCT_SUBSCR_FACT.SUBSCR_TRANSN_KEY AND T4.CUST_ACCT_TYPE_KEY = CUST_ACCT_SUBSCR_FACT.REC_CUST_ACCT_TYPE_KEY AND
casd.CUST_ACCT_STAT_KEY = CUST_ACCT_SUBSCR_FACT.REC_CUST_ACCT_STAT_KEY AND casd.CUST_ACCT_STAT_CODE= 'ACTV' AND
casd.CUTOFF_LEV_CODE <> 2) T4 ON T4.VW_CUST_ACCT_KEY = T3.VW_CUST_ACCT_KEY