SELECT DISTINCT 
   CS.CIRCUIT_ID,
   F.MARKET_NAME,
   F.CAP_ID,
   F.CABLE_NAME,
   F.BUFFER_COLOR,
   F.FIBER_COUNT,
   F.LOGICAL_FIBER_NUMBER,
   F.LOOP_NAME,
   F.RIBBON_LABEL,
   F.GLASS_TYPE,
   F.FIBER_COLOR,
   S.ACCOUNT_ID,
   S.ACCOUNT,
   S.PRODUCT,
   S.BANDWIDTH_CODE,
   CAST(F.POSITION AS INT),
   CS.HAS_CHILD,
   F.SOURCE AS FiberSource,
   CS.I_SOURCE AS NetworkSource,
   CASE
       WHEN F.ASSIGNMENT_STATUS IS NULL THEN 'ASSIGNABLE'
       ELSE F.ASSIGNMENT_STATUS
       END ASSIGNMENT_STATUS,
   CASE
       WHEN F.SOURCE LIKE 'TNE%' THEN ISNULL(CS.CUST_NAME, F.CUST_NAME)
       WHEN F.SOURCE LIKE 'BONES%' THEN F.CUST_NAME
       WHEN F.SOURCE LIKE 'FMS%' AND (F.ASSIGNMENT_STATUS = 'ASSIGNABLE' OR F.ASSIGNMENT_STATUS IS NULL) THEN F.CUST_NAME
       ELSE CS.CUST_NAME
       END CUST_NAME,
   S.LEGACY_CIRCUIT_ID,
   CS.LSID,
   S.UCID,
   S.UBIZ,
   S.UCUST,
   CS.PORT_TYPE,
   CS.PRODUCT_FAMILY
FROM FIBER F WITH (NOLOCK)
   LEFT OUTER JOIN CIIT_STAGING CS WITH (NOLOCK) ON (CS.CONSUMABLE_TP_EID = F.A_CONSUMABLE_TP_EID
            OR
         CS.CONSUMABLE_TP_EID = F.Z_CONSUMABLE_TP_EID )
   LEFT OUTER JOIN SERVICE_LOOKUP_MVW S WITH (NOLOCK) ON CS.CIRCUIT_ID = S.SID 
WHERE upper(f.cap_id) = '00073990'
            AND
         F.CABLE_NAME = '(264) 00073990.00073991.001'
            AND
         upper(f.buffer_color) = 'BL' 
ORDER BY CAST(F.POSITION AS INT),
   F.MARKET_NAME,
   F.CAP_ID,
   F.CABLE_NAME,
   F.BUFFER_COLOR,
   CS.CIRCUIT_ID