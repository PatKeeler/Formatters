WITH auth AS ( SELECT dcomp.comp_nm, DCOMP.d_client_id, DCOMP.d_comp_id FROM d_tcs_company DCOMP JOIN tcs_user_org_access ACS ON 
( dcomp.evo_org_id = acs.evo_org_id ) WHERE ACS.aoid = 'G3TB97BAZ3STVZ6B'), stat AS ( SELECT d_status_id, status_cd FROM d_tcs_status 
WHERE status_cd IN ( 'NH', 'SCRN', 'NSCRN', 'E', 'K', 'I', 'P', 'ELG' )), IQ AS ( SELECT * FROM ( SELECT FACT.D_EMPLOYEE_ID,
STATUS_EFFECTIVE_DT,STATUS_CD FROM F_TCS_DTL_COMPLIANCE FACT JOIN STAT ON (FACT.d_status_id = stat.d_status_id) JOIN D_TCS_COMPANY_FISCAL 
PERIOD ON (FACT.d_comp_id = PERIOD.D_COMP_ID) JOIN AUTH ON(FACT.D_CLIENT_ID = AUTH.D_CLIENT_ID AND FACT.D_COMP_ID = AUTH.D_COMP_ID) WHERE 
PERIOD.fiscal_year = 2014 AND FACT.STATUS_EFFECTIVE_DT BETWEEN PERIOD.FISCAL_YR_START_DT AND PERIOD.FISCAL_YR_END_DT) PIVOT (MAX( 
STATUS_EFFECTIVE_DT) FOR STATUS_CD IN ( 'NH' AS hireDate, 'SCRN' AS screenDate, 'NSCRN' AS notScreenedDate, 'E' AS formsExpired, 'K' 
AS formsReceived, 'P' AS formsPending, 'I' AS ineligible, 'ELG' AS eligible ) ) ) SELECT * FROM ( SELECT ROWNUM rnum, oq.* FROM ( 
SELECT auth.comp_nm company, LOC.location_cd location, LOC.city city, loc.state state, fact.d_employee_id AS employeeId, emp.last_nm || ', 
' || emp.first_nm AS name, iq.hiredate AS hireDate, iq.screendate AS screened, CASE WHEN iq.eligible IS NOT NULL THEN 'Y' ELSE NULL END AS 
eligible, CASE WHEN iq.notscreeneddate IS NOT NULL THEN 'Not Screened' WHEN iq.ineligible IS NOT NULL THEN 'Not Eligible' WHEN iq.eligible 
IS NOT NULL AND iq.formspending IS NOT NULL THEN 'Forms Pending' WHEN iq.eligible IS NOT NULL AND iq.formsreceived IS NOT NULL THEN 'Forms 
Received' WHEN iq.eligible IS NOT NULL AND iq.formsexpired IS NOT NULL THEN 'Forms Expired' END AS Details FROM f_tcs_dtl_compliance FACT 
JOIN iq ON ( fact.d_employee_id = iq.d_employee_id ) JOIN d_tcs_employee EMP ON ( FACT.d_employee_id = EMP.d_employee_id ) JOIN auth ON ( 
FACT.d_client_id = auth.d_client_id AND fact.d_comp_id = auth.d_comp_id ) JOIN stat ON ( FACT.d_status_id = stat.d_status_id AND ( 
stat.status_cd = 'SCRN' OR stat.status_cd = 'NSCRN' ) ) JOIN d_tcs_company_location LOC ON ( fact.d_comp_location_id = loc.d_comp_location_id ) 
ORDER BY name) oq WHERE ROWNUM <= 20) WHERE rnum > 0